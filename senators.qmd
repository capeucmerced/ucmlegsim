---
title: "Senators"
format: 
  html:
    page-layout: full
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(gt)
library(dplyr)

# Read the CSV file
senators <- read.csv("files/csvs/senator_list.csv")
senators <- senators %>%
  mutate(namesmatch = gsub(" ", "", Last.Name),
        namesmatch = tolower(namesmatch),
        name = paste(Last.Name, First.Name, sep = ", "))

# Check if the role_profiles folder exists and has any files
profile_folder_has_files <- dir.exists("files/pdfs/role_profiles/senators") && 
                           length(list.files("files/pdfs/role_profiles/senators")) > 0

# Check if Leadership roles are in
leadership_has_data <- "Leadership" %in% names(senators) && 
                       any(!is.na(senators$Leadership))                          

# Adding name column which links to specific senator page
senators$Name_Link <- paste0("[", senators$name, "](senator-pages/district_", senators$District, ".html)")

# Only add Profile column if the folder has files
if (profile_folder_has_files) {
  senators$Profile <- paste0("[View Profile](files/pdfs/role_profiles/senators/", senators$namesmatch, "_",  senators$District, "_profile.pdf)")
}

# Build the fmt_markdown columns list dynamically
markdown_columns <- c("Name_Link") 
if (profile_folder_has_files) {
  markdown_columns <- c(markdown_columns, "Profile")
}

# Build columns to hide dynamically
columns_to_hide <- c("namesmatch", "First.Name", "Last.Name", "name", "Committee", "Chair", "Vice.Chair")
if (!leadership_has_data) {
  columns_to_hide <- c(columns_to_hide, "Leadership")
}

# Create the table
senators %>%
  gt() %>%
  cols_hide(columns = all_of(columns_to_hide)) %>%
  cols_label(
    District = "District",
    Name_Link = "Name",
    Party = "Party"
  ) %>%
  cols_align(align = "left", columns = everything()) %>% 
  fmt_markdown(columns = all_of(markdown_columns)) %>%
  tab_header(
    title = "Senators",
    subtitle = "Click to view senator profile or activity"
  ) %>%
  opt_interactive(
    use_sorting = TRUE,
    use_search = TRUE,
    use_filters = FALSE,
    use_resizers = TRUE,
    page_size_default = 20
  ) %>%
  opt_row_striping() 
```