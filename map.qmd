---
title: "District Map"
format: 
  html:
    page-layout: full
    resources:
      - "files/other/ca_senate_districts.geojson"
execute:
  echo: false
  warning: false
  message: false
---

```{r}

library(leaflet)
library(sf)
library(htmlwidgets)
library(tidyverse)

# Read the GeoJSON data
districts <- suppressMessages(st_read("files/other/ca_senate_districts.geojson", quiet = TRUE))

# Create map with JavaScript embedded differently
map <- leaflet(districts) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%  
  addPolygons(
    weight = 1,
    opacity = 1,
    color = "#17345a",
    fillOpacity = 0.6,
    layerId = ~district,
    highlight = highlightOptions(
      weight = 4,
      color = "#d4a821",
      dashArray = "",
      fillOpacity = 0.7,
      bringToFront = TRUE
    ),
    label = ~paste("Click for District", district),  
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "13px",
      direction = "auto"
    )
  ) %>%
  setView(lng = -120, lat = 36.5, zoom = 5)

# Add the JavaScript after map creation
map %>% 
  onRender("
    function(el, x) {
      var myMap = this;
      
      myMap.on('click', function(e) {
        console.log('Map clicked at:', e.latlng);
        
        // Check if we clicked on a layer
        var clickedLayer = null;
        myMap.eachLayer(function(layer) {
          if (layer.getBounds && layer.getBounds().contains(e.latlng)) {
            clickedLayer = layer;
          }
        });
        
        if (clickedLayer && clickedLayer.options && clickedLayer.options.layerId) {
          var district = clickedLayer.options.layerId;
          console.log('District:', district);
          var url = '/senator-pages/district_' + district + '.html';
          console.log('Opening:', url);
          window.open(url, '_blank');
        }
      });
    }
  ")
```

