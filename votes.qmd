---
title: "Votes"
format: html
freeze: auto
execute:
  echo: false
  warning: false
  error: true  
---
::: {.panel-tabset}

## Committee A

```{r}

# --- Packages ---
# (Best practice: install these ahead of time; installing while rendering can fail in CI.)
for (pkg in c("readr","dplyr","gt","janitor")) {
  if (!requireNamespace(pkg, quietly = TRUE)) install.packages(pkg)
}
library(readr)
library(dplyr)
library(gt)
library(janitor)

# --- CONFIG: your published CSV link ---
votes_csv <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vSWsxVKMyPrvGZW1VFD0_DdTsMmH-dzITniXvWusbbG34FPwj7uWsIDB6B_6Sb5AdK94SbZ75eL0vTT/pub?gid=0&single=true&output=csv"   

# --- READ ---
dat <- read.csv(votes_csv) %>%
  rename_with(~ gsub("\\.", " ", .x))

senators <- read.csv("files/csvs/senator_list.csv")
s_names <- senators$Name
d_sen <- senators$Name[senators$Party == "D"]
r_sen <- senators$Name[senators$Party == "R"]

bills <- read.csv("files/csvs/bill_list.csv")

# --- Transformation ---
dat <- dat %>%
  rowwise() %>%
  mutate(yes = sum(c_across(any_of(s_names)) == 1, na.rm = TRUE),
        no = sum(c_across(any_of(s_names)) == 0, na.rm = TRUE),
        absent = sum(is.na(c_across(any_of(s_names)))),
        Vote = paste(yes, no, absent, sep = "—"),
        d_yes = sum(c_across(any_of(d_sen)) == 1, na.rm = TRUE),
        d_no = sum(c_across(any_of(d_sen)) == 0, na.rm = TRUE),
        d_absent = sum(is.na(c_across(any_of(d_sen)))),
        Dem_vote = paste(d_yes, d_no, d_absent, sep = "—"),
        Dem_percent = (d_yes/(d_yes + d_no + d_absent)*100),
        r_yes = sum(c_across(any_of(r_sen)) == 1, na.rm = TRUE),
        r_no = sum(c_across(any_of(r_sen)) == 0, na.rm = TRUE),
        r_absent = sum(is.na(c_across(any_of(r_sen)))),
        Rep_vote = paste(r_yes, r_no, r_absent, sep = "—"),
        Rep_percent = (r_yes/(r_yes + r_no + r_absent)*100),
        ) %>%
  left_join(bills, by = c("Bill" = "bill_number")) %>%
  select(Date, Bill, title, author, Vote, Result, Dem_percent, Rep_percent) 

# --- RENDER with gt ---
dat |>
  gt() |>
  tab_header(
    title = md("**Votes**"),
    subtitle = paste0("Last updated: ", format(Sys.time(), "%Y-%m-%d %H:%M %Z"))
  ) |>
  # fmt_missing is available in recent gt; if on older gt, comment this out:
  fmt_missing(columns = everything(), missing_text = "—") |>
  # Avoid opt_table_font(stack=TRUE) for broader compatibility:
  # opt_table_font() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(14)
  ) |>
  opt_row_striping() |>
  tab_source_note(md("Source: Google Sheet (published CSV)"))

```

## Committee B

```{r}

# --- Packages ---
# (Best practice: install these ahead of time; installing while rendering can fail in CI.)
for (pkg in c("readr","dplyr","gt","janitor")) {
  if (!requireNamespace(pkg, quietly = TRUE)) install.packages(pkg)
}
library(readr)
library(dplyr)
library(gt)
library(janitor)

# --- CONFIG: your published CSV link ---
votes_csv <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vSWsxVKMyPrvGZW1VFD0_DdTsMmH-dzITniXvWusbbG34FPwj7uWsIDB6B_6Sb5AdK94SbZ75eL0vTT/pub?gid=1077921709&single=true&output=csv"   

# --- READ ---
dat <- read.csv(votes_csv) %>%
  rename_with(~ gsub("\\.", " ", .x))

# --- Transformation ---
dat <- dat %>%
  rowwise() %>%
  mutate(yes = sum(c_across(any_of(s_names)) == 1, na.rm = TRUE),
        no = sum(c_across(any_of(s_names)) == 0, na.rm = TRUE),
        absent = sum(is.na(c_across(any_of(s_names)))),
        Vote = paste(yes, no, absent, sep = "—"),
        d_yes = sum(c_across(any_of(d_sen)) == 1, na.rm = TRUE),
        d_no = sum(c_across(any_of(d_sen)) == 0, na.rm = TRUE),
        d_absent = sum(is.na(c_across(any_of(d_sen)))),
        Dem_vote = paste(d_yes, d_no, d_absent, sep = "—"),
        Dem_percent = (d_yes/(d_yes + d_no + d_absent)*100),
        r_yes = sum(c_across(any_of(r_sen)) == 1, na.rm = TRUE),
        r_no = sum(c_across(any_of(r_sen)) == 0, na.rm = TRUE),
        r_absent = sum(is.na(c_across(any_of(r_sen)))),
        Rep_vote = paste(r_yes, r_no, r_absent, sep = "—"),
        Rep_percent = (r_yes/(r_yes + r_no + r_absent)*100),
        ) %>%
  left_join(bills, by = c("Bill" = "bill_number")) %>%
  select(Date, Bill, title, author, Vote, Result, Dem_percent, Rep_percent) 

# --- RENDER with gt ---
dat |>
  gt() |>
  tab_header(
    title = md("**Votes**"),
    subtitle = paste0("Last updated: ", format(Sys.time(), "%Y-%m-%d %H:%M %Z"))
  ) |>
  # fmt_missing is available in recent gt; if on older gt, comment this out:
  fmt_missing(columns = everything(), missing_text = "—") |>
  # Avoid opt_table_font(stack=TRUE) for broader compatibility:
  # opt_table_font() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(14)
  ) |>
  opt_row_striping() |>
  tab_source_note(md("Source: Google Sheet (published CSV)"))

```