---
title: "Bills"
format: html
execute:
  echo: false
  warning: false
  message: false
---


```{r}
library(gt)
library(tidyverse)


bills_csv <- "files/csvs/bill_list.csv"
senator_csv <- "files/csvs/senator_list.csv"
bills_dir  <- "files/pdfs/bills"
b_pages_dir  <- "bills-pages"
s_pages_dir  <- "senator-pages"

# read the first sheet of your Excel file
bill_list <- read.csv(bills_csv) 
senator_list <- read.csv(senator_csv)

bill_list <- bill_list %>%
  mutate(name = paste(First.Name, Last.Name, sep = " "),
        name_join = tolower(paste0(First.Name, Last.Name)),
        name_join = gsub(" ", "", name_join),
        bill_measure = paste0("SB-", bill_number),
        url = paste0(toupper(Last.Name), "_", "SB", bill_number),
        committee = ifelse(committee == "" | is.na(committee), "Unassigned", committee),
        appropriations = ifelse(appropriations == 1, "Yes", "No")) 

senator_list <- senator_list %>%
  mutate(name_join = tolower(paste0(First.Name, Last.Name)),
          name_join = gsub(" ", "", name_join))%>%
  select(-First.Name, -Last.Name )

bill_list <- left_join(bill_list, senator_list, by = "name_join")

bill_list$PDF <- paste0("[View Bill Text](", bills_dir,  "/", bill_list$url, ".pdf)")

bill_list$Page <- paste0("[View Details](", b_pages_dir, "/", bill_list$url, ".html)")

# simple nice table with kableExtra
bill_list %>%
  select(bill_measure, title, name, lobbyist, committee, appropriations, PDF, Page) %>% 
  gt() %>% 
  fmt_markdown(columns = c("PDF", "Page")) %>%
  cols_label(
    bill_measure = "Bill",
    title = "Subject",
    name = "Author",
    lobbyist = "Supporting Lobby",
    committee = "Committee",
    appropriations = "Appropriations",
    Page = "Bill Details",
    PDF = "PDF"
  ) %>%
  tab_header(
    title = "Bills",
    subtitle = "Click a link to open the corresponding PDF"
  )
```
